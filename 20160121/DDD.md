DDD
===

> SlideShare: [ドメイン駆動設計のためのオブジェクト指向入門](http://www.slideshare.net/masuda220/ss-57352072)

## DDD(domain-driven design)
- 「ドメイン」層のソフトウェア設計
- オブジェクト指向設計
- XP(extreme programming)
    - ドキュメントより言葉
    - 変更
    - インクリメンタル
- ドメインを学び、学んだことをコードで表現する

1. 学習→知識
2. 議論→言葉
3. 行動/表現→コード

## OOP/XP
- analyst(domain) = coder(code)
- analyze and code everyday
- 会話 cf.ドキュメント

## 実装例
- Spring MVC + iBATIS
- プレゼンテーション層(@Controller)、サービス層(@Service)、データソース層(@Repository)
    - →ドメイン層以外を提供

- ドメイン層→POJO(plain old Java object)
    - NOT JavaBeans
    - 関心事(知りたいこと、業務ルール)
    - 業務サービス(判断、計算、加工の結果を返す; NOT primitive)

## OO
- classでコード整理
- 変更コスト抑制
- 局所化
- 凝集、疎結合
- NOT データクラス&機能クラス

## ドメイン層の構造
- 集約(aggregate)単位
    - →分析・設計・実装
- NOT 画面単位、機能単位

## アーキテクチャ
- オブジェクトの集合体
- 関連する部品で集約
- 集約間は疎結合
- LAN(集約)とInternet(全体)

## プロセス
- インクリメンタル
- 進化的
- いつでも変更
- OOとAgile/XP


## オブジェクト設計
### 独自の型の設計
- 関心事→独自の型
- 知識の表現手段
- cf. 基本データ型、標準API→隠蔽

### オブジェクトのコラボレーションの設計
- 契約による設計(Design by Contract)、責任駆動設計、集約、メッセージパッシング……
- 役割分担
- 協力関係

- 「契約による設計」バートランド・メイヤー
    - 対等の個の間での双方向の権利義務関係の明文化「契約」
    - cf. 売買契約/契約法
    - ※assert構文

### 実現手段(how)の隠蔽
- 言語仕様、標準APIを見せない
- e.g. publicメソッドの引数/戻り値の型
- value object
- first-class collection
- enum
- Bean Validation
- NOT return null/Optional/primitive


## DDD実践
1. 初級: フレームワークと規約を採用
2. 中級: ドメインロジックをドメイン層に移動
3. 上級: 深いリファクタリング→コア(主要な関心事)の隔離/抽象化

- ドメインの型を渡してドメインの型を返す

- e.g. ドメイン層→30-60行のJavaクラス数千個

## 参照オブジェクト/Entity
- 主要な関心事への参照点、語彙の起点

### [実装]
- 集約

- cf. JPAの@Entity
- 永続化のためのテーブルと対応したクラス
    - →業務の関心事とは必ずしも一致しない
    - →変更コストあり

## 値オブジェクト
- 業務の関心事の基本語彙
- 目的に特化して制約をかける→可読性、安定性
- ロジックを集約→重複排除

### [実装]
- 完全コンストラクタ
- 不変
- ロジックの場
- NOT getter/setter

## 一覧オブジェクト(first-class collection)
- 「一覧」「履歴」などの関心事の表現

### [実装]
- List/Setのラッパー
- cf. SQLでの抽出・加工

## 区分オブジェクト
- 振る舞いを持ったenum(←言語サポート: Java, Swift, Python?)
- Strategy/Stateパターン

- 関心事の明示的なコード表現
- 条件文の抑制→可読性、安定性
- 変更の副作用の抑制

## howよりwhat

## 深い洞察へ向かうリファクタリング
- e.g. メールとスカウトメール
- スカウトメールの未読／既読がわかりづらい
    - →ドメイン層で重要な関心事が埋もれている!

## 学び方
### 言葉→体験→言葉
- 学ぶ→コード書く→もう一度学ぶ

### 変更作業
- 変更の前にリファクタリング
- 既存コードの設計と比較→変化の実感

## 参考
- 『リファクタリング』
- 『実装パターン』
- 『(未定; オブジェクト指向の入門書)』※技術評論社3月刊行予定
- 『オブジェクト指向入門』バートランド・メイヤー
- 『ドメイン駆動設計』

## 更新系
- 小さな単位でこまめに更新←→大きな単位でトランザクション

## ドキュメント
- 必要なものは書く
- メンテナンスしない

## 言語機能の隠蔽
- コンストラクタも隠蔽したい
- new→低レベル(memory allocation; malloc)

## ビジネス
- ビジネスの変化のスピード
    - →今のやり方を捉えることで変化に追随できる
    - →DDD/OOによって変更に強くなる
- ドメインエキスパートの不在
    - →開発者自身がビジネスの世界に入っていく、議論に参加する
